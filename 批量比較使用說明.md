# Config 4 vs Config 5 批量比較使用說明

## 📋 腳本功能

本套腳本可以自動執行 **Config 4 (SpSA)** 和 **Config 5 (ApSA)** 的批量比較測試，並生成完整的比較報告。

## 📁 腳本文件

1. **`quick_test_config4_5.py`** - 快速測試腳本（推薦先用這個）
2. **`batch_compare_config4_5.py`** - 完整批量比較腳本
3. **`compare_energy_plots_cli.py`** - 能量圖表比較工具（已存在）

## 🚀 使用步驟

### 步驟1: 快速測試（推薦）

先執行快速測試來驗證腳本和配置是否正常工作：

```bash
python quick_test_config4_5.py
```

這會：
- 自動選擇2個較小的圖檔進行測試
- 使用較短的參數（cycle=200, trial=3）
- 在幾分鐘內完成測試
- 驗證Config 4和5都能正常執行

### 步驟2: 完整批量測試

如果快速測試成功，執行完整的批量比較：

```bash
python batch_compare_config4_5.py
```

這會：
- 對 `graph/` 目錄中的所有G*.txt檔案執行測試
- 每個圖檔都會執行Config 4和Config 5
- 使用完整參數（cycle=1000, trial=10）
- 自動生成比較圖表和Excel總結

## 📊 輸出結果

### 輸出目錄：`./0711compare4_5/`

1. **比較圖表**
   - `energy_comparison_YYYYMMDD_HHMMSS.png` - 每個圖的Config 4 vs 5能量比較圖
   - `energy_comparison_YYYYMMDD_HHMMSS.xlsx` - 對應的數據檔案

2. **總結Excel**
   - `config4_vs_5_summary_YYYYMMDD_HHMMSS.xlsx` - 包含以下工作表：
     - `All_Results` - 所有原始結果
     - `Config4_SpSA` - Config 4的結果
     - `Config5_ApSA` - Config 5的結果  
     - `Comparison` - 詳細比較分析

### Excel總結包含的資訊

- **效能指標**: Average Cut, Maximum Cut, Minimum Cut
- **品質指標**: Average Reachability, Maximum Reachability
- **效率指標**: Average Time, Total Time, Execution Time
- **統計指標**: Std of Cut Value, TTS(0.99)
- **比較分析**: Cut Improvement, Time Speedup, Reachability Improvement

## ⚙️ 測試參數

### Config 4 (SpSA) 參數：
```bash
--config 4 --cycle 1000 --trial 10 --tau 8 --res 2 
--l_scale 0.1 --d_scale 0.1 --n_scale 0.1
```

### Config 5 (ApSA) 參數：
```bash
--config 5 --cycle 1000 --trial 10 --tau 8 --res 2
--l_scale 0.1 --d_scale 0.1 --n_scale 0.1
--stall_threshold 400 --eta_alpha 0.0 --eta_beta 0.0005 
--target_drop 20 --window_size 200
```

## 🎯 單個測試指令

如果想要手動測試單個圖檔：

### Config 4:
```bash
python gpu_MAXCUT_var0708.py --config 4 --file_path ./graph/G1.txt --cycle 1000 --trial 10 --tau 8 --res 2 --l_scale 0.1 --d_scale 0.1 --n_scale 0.1
```

### Config 5:
```bash
python gpu_MAXCUT_var0708.py --config 5 --file_path ./graph/G1.txt --cycle 1000 --trial 10 --tau 8 --res 2 --l_scale 0.1 --d_scale 0.1 --n_scale 0.1 --stall_threshold 400 --eta_alpha 0.0 --eta_beta 0.0005 --target_drop 20 --window_size 200
```

## 📈 進階選項

### 自訂參數的快速測試：
```bash
python quick_test_config4_5.py --cycle 500 --trial 5
```

### 指定Excel比較：
```bash
python compare_energy_plots_cli.py --interactive
```

## ⏱️ 預估執行時間

- **快速測試**: 2-5分鐘（2個小圖，短參數）
- **單個大圖完整測試**: 10-30分鐘
- **所有9個圖完整測試**: 2-6小時（依圖大小而定）

## 🔍 故障排除

### 如果Config 5執行失敗：
1. 檢查CUDA記憶體是否足夠
2. 嘗試降低參數：
   ```bash
   --cycle 500 --trial 5 --window_size 100
   ```

### 如果比較圖生成失敗：
1. 檢查 `./0708_energy_plots/` 目錄是否有對應的Excel檔案
2. 手動執行比較：
   ```bash
   python compare_energy_plots_cli.py --list-files
   python compare_energy_plots_cli.py --interactive
   ```

### 如果記憶體不足：
1. 分批執行較小的圖檔
2. 降低trial和cycle參數
3. 重啟系統清理GPU記憶體

## 💡 使用建議

1. **首次使用**: 先執行 `python quick_test_config4_5.py` 
2. **正式比較**: 執行 `python batch_compare_config4_5.py`
3. **監控進度**: 腳本會顯示詳細的執行進度
4. **檢查結果**: 查看 `./0711compare4_5/` 目錄中的結果

## 🎉 預期結果

成功執行後，您將獲得：
- ✅ 每個圖檔的Config 4 vs 5 能量收斂比較圖
- ✅ 完整的效能比較Excel表
- ✅ 統計分析和改善幅度報告
- ✅ 自動化的圖表和數據整理

---

**注意**: 完整批量測試可能需要數小時，建議在充足時間和穩定環境下執行。 